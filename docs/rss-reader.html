<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Feed Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.png" type="image/png">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .feed-card {
            transition: all 0.3s ease;
        }
        .feed-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -4px rgba(0, 0, 0, 0.3);
        }
        .spinner {
            border: 3px solid #374151;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .chip {
            transition: all 0.2s ease;
        }
        .chip:hover {
            background-color: #f59e0b;
            color: #111827;
        }
        .card-thumbnail {
            object-fit: cover;
            width: 100%;
            height: 100%;
        }
        .gradient-placeholder {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <!-- Back to Dashboard -->
        <a href="index.html" class="inline-flex items-center gap-2 text-sm text-gray-400 hover:text-amber-500 transition mb-6">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back to Dashboard
        </a>

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">
                <span class="bg-gradient-to-r from-amber-400 to-yellow-500 bg-clip-text text-transparent">RSS Feed Reader</span>
            </h1>
            <p class="mt-2 text-lg text-gray-400">Paste any RSS or Atom feed URL to browse the latest articles</p>
        </header>

        <!-- Input Section -->
        <div class="bg-gray-800 rounded-2xl p-6 border border-gray-700 mb-6">
            <div class="flex flex-col sm:flex-row gap-3">
                <input
                    type="url"
                    id="feedUrl"
                    placeholder="Enter RSS feed URL..."
                    class="flex-1 bg-gray-700 border border-gray-600 text-gray-100 px-4 py-3 rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/50 placeholder-gray-400"
                >
                <button
                    id="loadBtn"
                    onclick="loadFeed()"
                    class="bg-gradient-to-r from-amber-500 to-yellow-600 text-gray-900 font-semibold px-6 py-3 rounded-lg hover:from-amber-400 hover:to-yellow-500 transition-all whitespace-nowrap"
                >
                    Load Feed
                </button>
            </div>

            <!-- Quick-pick chips -->
            <div class="mt-4 flex flex-wrap gap-2">
                <span class="text-xs text-gray-500 self-center mr-1">Try:</span>
                <button onclick="quickPick('https://feeds.bbci.co.uk/news/rss.xml')" class="chip px-3 py-1 text-xs rounded-full border border-gray-600 text-gray-300 cursor-pointer bg-gray-700">BBC News</button>
                <button onclick="quickPick('https://hnrss.org/frontpage')" class="chip px-3 py-1 text-xs rounded-full border border-gray-600 text-gray-300 cursor-pointer bg-gray-700">Hacker News</button>
                <button onclick="quickPick('https://www.reddit.com/r/technology/.rss')" class="chip px-3 py-1 text-xs rounded-full border border-gray-600 text-gray-300 cursor-pointer bg-gray-700">r/technology</button>
                <button onclick="quickPick('https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml')" class="chip px-3 py-1 text-xs rounded-full border border-gray-600 text-gray-300 cursor-pointer bg-gray-700">NY Times</button>
            </div>
        </div>

        <!-- Feed Metadata -->
        <div id="feedMeta" class="hidden bg-gray-800 rounded-2xl p-5 border border-gray-700 mb-6">
            <h2 id="feedTitle" class="text-xl font-bold text-white"></h2>
            <p id="feedDescription" class="text-sm text-gray-400 mt-1"></p>
            <p id="feedLastBuild" class="text-xs text-gray-500 mt-2"></p>
        </div>

        <!-- Loading Spinner -->
        <div id="loading" class="hidden flex flex-col items-center justify-center py-16">
            <div class="spinner"></div>
            <p class="mt-4 text-gray-400 text-sm">Fetching feed...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-red-900/30 border border-red-700 rounded-2xl p-6 text-center mb-6">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mx-auto mb-3 text-red-400">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <p id="errorMessage" class="text-red-300 font-medium"></p>
            <p class="text-red-400/70 text-sm mt-1">Check the URL and try again. Make sure it points to a valid RSS or Atom feed.</p>
        </div>

        <!-- Feed Items Grid -->
        <div id="feedGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>

    <script>
        function quickPick(url) {
            document.getElementById('feedUrl').value = url;
            loadFeed();
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function showError(message) {
            const el = document.getElementById('errorState');
            document.getElementById('errorMessage').textContent = message;
            el.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorState').classList.add('hidden');
        }

        function relativeTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return dateStr;
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHr = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHr / 24);

            if (diffSec < 60) return 'just now';
            if (diffMin < 60) return diffMin + (diffMin === 1 ? ' minute ago' : ' minutes ago');
            if (diffHr < 24) return diffHr + (diffHr === 1 ? ' hour ago' : ' hours ago');
            if (diffDay < 7) return diffDay + (diffDay === 1 ? ' day ago' : ' days ago');
            return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        }

        function stripHtml(html) {
            if (!html) return '';
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        function truncate(str, len) {
            if (!str) return '';
            str = str.trim();
            if (str.length <= len) return str;
            return str.substring(0, len).trimEnd() + '...';
        }

        function extractImage(item, ns) {
            // Try media:content
            const mediaContent = item.getElementsByTagNameNS('http://search.yahoo.com/mrss/', 'content');
            if (mediaContent.length > 0) {
                const url = mediaContent[0].getAttribute('url');
                if (url) return url;
            }

            // Try media:thumbnail
            const mediaThumbnail = item.getElementsByTagNameNS('http://search.yahoo.com/mrss/', 'thumbnail');
            if (mediaThumbnail.length > 0) {
                const url = mediaThumbnail[0].getAttribute('url');
                if (url) return url;
            }

            // Try enclosure
            const enclosure = item.querySelector('enclosure');
            if (enclosure) {
                const type = enclosure.getAttribute('type') || '';
                if (type.startsWith('image/')) {
                    return enclosure.getAttribute('url');
                }
            }

            // Try to extract first image from description/content
            const descEl = item.querySelector('description') || item.querySelector('summary') || item.querySelector('content');
            if (descEl) {
                const desc = descEl.textContent || '';
                const imgMatch = desc.match(/<img[^>]+src=["']([^"']+)["']/i);
                if (imgMatch) return imgMatch[1];
            }

            return null;
        }

        function getTextContent(item, selectors) {
            for (const sel of selectors) {
                const el = item.querySelector(sel);
                if (el && el.textContent.trim()) return el.textContent.trim();
            }
            return '';
        }

        function getLink(item) {
            // RSS: <link> text content
            const linkEl = item.querySelector('link');
            if (linkEl) {
                // Atom feeds use href attribute
                const href = linkEl.getAttribute('href');
                if (href) return href;
                // RSS feeds use text content
                if (linkEl.textContent.trim()) return linkEl.textContent.trim();
            }
            // Atom alternate link
            const links = item.querySelectorAll('link');
            for (const l of links) {
                if (l.getAttribute('rel') === 'alternate' || !l.getAttribute('rel')) {
                    const href = l.getAttribute('href');
                    if (href) return href;
                }
            }
            return '#';
        }

        function getAuthor(item) {
            // dc:creator
            const dcCreator = item.getElementsByTagNameNS('http://purl.org/dc/elements/1.1/', 'creator');
            if (dcCreator.length > 0 && dcCreator[0].textContent.trim()) return dcCreator[0].textContent.trim();

            // author > name (Atom)
            const authorName = item.querySelector('author > name');
            if (authorName && authorName.textContent.trim()) return authorName.textContent.trim();

            // author (RSS)
            const author = item.querySelector('author');
            if (author && author.textContent.trim()) return author.textContent.trim();

            return '';
        }

        function parseItems(doc) {
            const items = [];

            // RSS 2.0
            let entries = doc.querySelectorAll('item');
            if (entries.length === 0) {
                // Atom
                entries = doc.querySelectorAll('entry');
            }

            for (const entry of entries) {
                const title = getTextContent(entry, ['title']);
                const link = getLink(entry);
                const description = stripHtml(getTextContent(entry, ['description', 'summary', 'content']));
                const pubDate = getTextContent(entry, ['pubDate', 'published', 'updated', 'date']);
                const image = extractImage(entry);
                const author = getAuthor(entry);

                items.push({ title, link, description, pubDate, image, author });
            }

            return items;
        }

        function parseFeedMeta(doc) {
            // RSS 2.0: channel > title
            const channel = doc.querySelector('channel');
            if (channel) {
                return {
                    title: getTextContent(channel, ['title']),
                    description: getTextContent(channel, ['description']),
                    lastBuild: getTextContent(channel, ['lastBuildDate', 'pubDate']),
                };
            }
            // Atom: feed > title
            const feed = doc.querySelector('feed');
            if (feed) {
                return {
                    title: getTextContent(feed, ['title']),
                    description: getTextContent(feed, ['subtitle']),
                    lastBuild: getTextContent(feed, ['updated']),
                };
            }
            return { title: '', description: '', lastBuild: '' };
        }

        function renderCard(item) {
            const excerpt = truncate(item.description, 150);
            const time = relativeTime(item.pubDate);
            const imgHtml = item.image
                ? `<img src="${item.image}" alt="" class="card-thumbnail" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'gradient-placeholder w-full h-full\\'></div>'">`
                : `<div class="gradient-placeholder w-full h-full flex items-center justify-center">
                       <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1.5">
                           <path d="M4 11a9 9 0 0 1 9 9"></path>
                           <path d="M4 4a16 16 0 0 1 16 16"></path>
                           <circle cx="5" cy="19" r="1"></circle>
                       </svg>
                   </div>`;

            const authorHtml = item.author ? `<span class="text-xs text-gray-500">${item.author}</span>` : '';

            return `
                <a href="${item.link}" target="_blank" rel="noopener noreferrer" class="feed-card bg-gray-800 rounded-xl border border-gray-700 overflow-hidden block">
                    <div class="h-44 overflow-hidden bg-gray-700">
                        ${imgHtml}
                    </div>
                    <div class="p-5">
                        <h3 class="text-base font-semibold text-white mb-2 line-clamp-2 leading-snug">${item.title || 'Untitled'}</h3>
                        <p class="text-sm text-gray-400 mb-3 line-clamp-3">${excerpt}</p>
                        <div class="flex items-center justify-between">
                            ${time ? `<span class="text-xs text-amber-500">${time}</span>` : '<span></span>'}
                            ${authorHtml}
                        </div>
                    </div>
                </a>
            `;
        }

        async function loadFeed() {
            const url = document.getElementById('feedUrl').value.trim();
            if (!url) {
                showError('Please enter a feed URL.');
                return;
            }

            hideError();
            document.getElementById('feedGrid').innerHTML = '';
            document.getElementById('feedMeta').classList.add('hidden');
            showLoading(true);

            try {
                const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(url);
                const response = await fetch(proxyUrl);

                if (!response.ok) {
                    throw new Error('Failed to fetch feed (HTTP ' + response.status + ')');
                }

                const xmlText = await response.text();

                if (!xmlText) {
                    throw new Error('Empty response from feed.');
                }

                const parser = new DOMParser();
                const doc = parser.parseFromString(xmlText, 'application/xml');

                // Check for parse errors
                const parseError = doc.querySelector('parsererror');
                if (parseError) {
                    throw new Error('Could not parse the feed. Make sure the URL points to valid RSS or Atom XML.');
                }

                // Feed metadata
                const meta = parseFeedMeta(doc);
                if (meta.title) {
                    document.getElementById('feedTitle').textContent = meta.title;
                    document.getElementById('feedDescription').textContent = meta.description || '';
                    document.getElementById('feedLastBuild').textContent = meta.lastBuild
                        ? 'Last updated: ' + relativeTime(meta.lastBuild)
                        : '';
                    document.getElementById('feedMeta').classList.remove('hidden');
                }

                // Parse items
                const items = parseItems(doc);
                if (items.length === 0) {
                    throw new Error('No feed items found. The URL may not be a valid RSS or Atom feed.');
                }

                // Render
                const grid = document.getElementById('feedGrid');
                grid.innerHTML = items.map(renderCard).join('');

            } catch (err) {
                showError(err.message || 'An unexpected error occurred.');
            } finally {
                showLoading(false);
            }
        }

        // Allow pressing Enter in the input to load
        document.getElementById('feedUrl').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') loadFeed();
        });
    </script>
</body>
</html>
