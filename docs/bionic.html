<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Productivity App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* General Body and App Container Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .app-container {
            height: calc(100vh - 5rem); /* Full height minus header */
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Tab Navigation Styles */
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 2px solid transparent;
            font-weight: 500;
            color: #475569; /* slate-600 */
            transition: all 0.2s ease-in-out;
        }
        .tab-button:hover {
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
        }
        .tab-button.active {
            background-color: #ffffff;
            color: #0f172a; /* slate-900 */
            border-color: #e2e8f0; /* slate-200 */
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }

        /* --- Scoped Styles for Markdown Editor --- */
        #markdown-app {
            background-color: #f1f5f9;
        }
        #markdown-app ::-webkit-scrollbar { width: 8px; height: 8px; }
        #markdown-app ::-webkit-scrollbar-track { background: #f1f5f9; }
        #markdown-app ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        #markdown-app ::-webkit-scrollbar-thumb:hover { background: #475569; }
        #markdown-app .resizer { background-color: #cbd5e1; cursor: col-resize; width: 8px; height: 100%; z-index: 5; transition: background-color 0.2s; }
        #markdown-app .resizer:hover, #markdown-app .resizing { background-color: #3b82f6; }
        #markdown-app .preview-content h1, #markdown-app .preview-content h2, #markdown-app .preview-content h3 { border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem; margin-top: 1.5rem; margin-bottom: 1rem; }
        #markdown-app .preview-content h1 { font-size: 2.25rem; }
        #markdown-app .preview-content h2 { font-size: 1.875rem; }
        #markdown-app .preview-content h3 { font-size: 1.5rem; }
        #markdown-app .preview-content p { margin-bottom: 1rem; line-height: 1.6; }
        #markdown-app .preview-content a { color: #2563eb; text-decoration: underline; }
        #markdown-app .preview-content code { background-color: #f1f5f9; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; }
        #markdown-app .preview-content pre { background-color: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-bottom: 1rem; }
        #markdown-app .preview-content pre code { background-color: transparent; padding: 0; }
        #markdown-app .preview-content blockquote { border-left: 4px solid #94a3b8; padding-left: 1rem; color: #64748b; margin-left: 0; margin-bottom: 1rem; }
        #markdown-app .preview-content ul, #markdown-app .preview-content ol { padding-left: 2rem; margin-bottom: 1rem; }
        #markdown-app .preview-content ul { list-style-type: disc; list-style-position: inside; }
        #markdown-app .preview-content ol { list-style-type: decimal; list-style-position: inside; }
        #markdown-app .preview-content li { margin-bottom: 0.5rem; }
        #markdown-app #editor-pane, #markdown-app #preview-pane {
            height: calc(100vh - 5rem - 4rem - 3.5rem); /* Full - header - app-header - padding */
        }
        #markdown-app #markdown-input, #markdown-app #html-output {
            height: 100%;
        }


        /* --- Scoped Styles for WebP Converter --- */
        #webp-app {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f4f7f6;
            color: #333;
            padding: 20px;
            box-sizing: border-box;
        }
        #webp-app .container { background-color: #ffffff; padding: 30px 40px; border-radius: 10px; box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); text-align: center; width: 100%; max-width: 500px; }
        #webp-app h1 { color: #007bff; margin-bottom: 25px; }
        #webp-app label { display: block; margin-bottom: 8px; font-weight: bold; text-align: left; }
        #webp-app input[type="file"], #webp-app select { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        #webp-app input[type="file"] { background-color: #e9ecef; cursor: pointer; }
        #webp-app input[type="file"]::file-selector-button { margin-right: 10px; border: none; background: #007bff; padding: 8px 12px; border-radius: 4px; color: #fff; cursor: pointer; transition: background .2s ease-in-out; }
        #webp-app input[type="file"]::file-selector-button:hover { background: #0056b3; }
        #webp-app button { background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s ease; width: 100%; }
        #webp-app button:hover { background-color: #218838; }
        #webp-app button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #webp-app .output-area { margin-top: 25px; text-align: center; }
        #webp-app .output-area img { max-width: 100%; max-height: 200px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px; }
        #webp-app .output-area a { display: inline-block; background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; font-weight: bold; transition: background-color 0.3s ease; }
        #webp-app .output-area a:hover { background-color: #0056b3; }
        #webp-app .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #007bff; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #webp-app #statusMessage { margin-top: 15px; font-style: italic; color: #555; }

        /* --- Scoped Styles for Bionic Reader --- */
        #bionic-app { background-color: #f4f7f6; color: #333; line-height: 1.6; padding: 1.5rem; overflow-y: auto;}
        #bionic-app .container { max-width: 1200px; }
        #bionic-app textarea { min-height: 250px; resize: vertical; }
        #bionic-app #outputArea { min-height: 350px; overflow-y: auto; border: 1px solid #d1d5db; padding: 1rem; background-color: #fff; border-radius: 0.5rem; box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.1); overflow-wrap: break-word; }
        #bionic-app .bionic-bold { font-weight: 700; }
        #bionic-app #outputArea h1, #bionic-app #outputArea h2, #bionic-app #outputArea h3, #bionic-app #outputArea h4, #bionic-app #outputArea h5, #bionic-app #outputArea h6 { font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        #bionic-app #outputArea h1 { font-size: 2em; } #bionic-app #outputArea h2 { font-size: 1.75em; } #bionic-app #outputArea h3 { font-size: 1.5em; } #bionic-app #outputArea h4 { font-size: 1.25em; } #bionic-app #outputArea h5 { font-size: 1em; } #bionic-app #outputArea h6 { font-size: 0.875em; }
        #bionic-app #outputArea p { margin-bottom: 1em; }
        #bionic-app #outputArea ul, #bionic-app #outputArea ol { margin-bottom: 1em; padding-left: 2em; }
        #bionic-app #outputArea li { margin-bottom: 0.5em; list-style-type: disc; }
        #bionic-app #outputArea ol li { list-style-type: decimal; }
        #bionic-app #outputArea strong { font-weight: 700; }
        #bionic-app .controls-section { min-width: 250px; max-width: 300px; }
        @media (min-width: 768px) { #bionic-app .main-layout { display: flex; gap: 1.5rem; } #bionic-app .content-section { flex-grow: 1; } }

    </style>
</head>
<body class="h-full antialiased">
    <header class="bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-20 flex-shrink-0 h-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-full">
            <a href="index.html" class="inline-flex items-center gap-2 text-xs text-slate-600 hover:text-blue-600 transition">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Dashboard
            </a>
            <nav id="app-tabs" class="flex items-center space-x-2 bg-slate-200/50 p-1 rounded-lg">
                <button data-app="markdown-app" class="tab-button active">Markdown Editor</button>
                <button data-app="bionic-app" class="tab-button">Bionic Reader</button>
                <button data-app="webp-app" class="tab-button">WebP Converter</button>
                <button data-app="picker-app" class="tab-button">Random Picker</button>
            </nav>
            <div class="w-20"></div> <!-- Spacer for balance -->
        </div>
    </header>

    <div id="markdown-app" class="app-container"></div>
    <div id="webp-app" class="app-container" style="display:none;"></div>
    <div id="bionic-app" class="app-container" style="display:none;"></div>
    <div id="picker-app" class="app-container" style="display:none;"></div>

    <script>
    const appTemplates = {
            "markdown-app": `
                <header class="bg-white/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-10 flex-shrink-0">
                    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-between h-16">
                            <div class="flex items-center space-x-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-700"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                                <h1 class="text-xl font-bold text-slate-800">Markdown Editor</h1>
                            </div>
                            <div class="flex items-center space-x-1 bg-slate-100 p-1 rounded-lg">
                                <button id="boldBtn" title="Bold (Cmd+B)" class="p-2 rounded-md hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path></svg></button>
                                <button id="italicBtn" title="Italic (Cmd+I)" class="p-2 rounded-md hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="4" x2="10" y2="4"></line><line x1="14" y1="20" x2="5" y2="20"></line><line x1="15" y1="4" x2="9" y2="20"></line></svg></button>
                                <button id="strikeBtn" title="Strikethrough (Cmd+Shift+S)" class="p-2 rounded-md hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4H9a3 3 0 0 0-2.83 4"></path><path d="M14 12a4 4 0 0 1 0 8H6"></path><line x1="4" y1="12" x2="18" y2="12"></line></svg></button>
                                <div class="w-px h-5 bg-slate-300 mx-1"></div>
                                <button id="headingBtn" title="Heading (Cmd+H)" class="p-2 rounded-md hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12h8"></path><path d="M4 18V6"></path><path d="M12 18V6"></path><path d="m17 13 3-3-3-3"></path></svg></button>
                                <button id="linkBtn" title="Link (Cmd+K)" class="p-2 rounded-md hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg></button>
                                <button id="bionicBtn" title="Send to Bionic Reader" class="p-2 rounded-md hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></button>
                            </div>
                            <button id="exportButton" class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors bg-slate-900 text-slate-50 hover:bg-slate-900/90 h-10 px-4 py-2">Export to .md</button>
                        </div>
                    </div>
                </header>
                <main id="main-container" class="flex-grow grid grid-cols-[1fr,auto,1fr] p-4 gap-0 max-w-full w-full">
                    <div id="editor-pane" class="flex flex-col min-w-0"><label for="markdown-input" class="text-sm font-medium text-slate-600 mb-2 px-1">Editor</label><textarea id="markdown-input" class="w-full h-full p-4 rounded-lg border border-slate-300 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out resize-none bg-white font-mono text-sm"></textarea></div>
                    <div id="resizer" class="resizer mx-2 rounded-full"></div>
                    <div id="preview-pane" class="flex flex-col min-w-0"><label class="text-sm font-medium text-slate-600 mb-2 px-1">Preview</label><div id="html-output" class="w-full h-full p-6 bg-white rounded-lg border border-slate-200 shadow-sm overflow-y-auto preview-content"></div></div>
                </main>
            `,
            "webp-app": `
                <div class="container">
                    <h1>WebP to PNG/JPG Converter</h1>
                    <div><label for="webpFile">Choose a WebP file:</label><input type="file" id="webpFile" name="webpFile" accept=".webp"></div>
                    <div><label for="outputFormat">Convert to:</label><select id="outputFormat" name="outputFormat"><option value="png">PNG</option><option value="jpeg">JPG (JPEG)</option></select></div>
                    <div id="qualityControl" style="display:none;"><label for="jpegQuality">JPG Quality (0.1 - 1.0):</label><input type="range" id="jpegQuality" name="jpegQuality" min="0.1" max="1.0" step="0.05" value="0.9"><span id="jpegQualityValue">0.9</span></div>
                    <button id="convertButton" disabled>Convert & Download</button>
                    <div class="loader" id="loader"></div><p id="statusMessage"></p>
                    <div class="output-area" id="outputArea"></div>
                </div>
            `,
            "bionic-app": `
                <div class="container mx-auto bg-white p-6 rounded-lg shadow-xl">
                    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Bionic Reader Converter</h1>
                    <div class="main-layout flex flex-col md:flex-row">
                        <div class="content-section flex-grow">
                            <div class="mb-6"><label for="inputText" class="block text-gray-700 text-sm font-semibold mb-2">Paste your text (Markdown supported):</label><textarea id="inputText" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md p-3" placeholder="Enter text to convert..."></textarea></div>
                            <div><label for="outputArea" class="block text-gray-700 text-sm font-semibold mb-2">Bionic Reader & Markdown Output:</label><div id="outputArea" class="text-gray-800"><p class="text-gray-500 italic">Your converted text will appear here.</p></div></div>
                        </div>
                        <div class="controls-section p-4 bg-gray-50 rounded-md shadow-inner mt-6 md:mt-0">
                            <h2 class="text-xl font-semibold mb-4 text-gray-700">Adjust Formatting</h2>
                            <div class="mb-4"><label for="boldIntensity" class="block text-gray-700 text-sm font-medium mb-2">Number of Bold Letters:</label><input type="range" id="boldIntensity" name="boldIntensity" min="1" max="5" value="2" class="form-range accent-blue-600 w-full"><span id="intensityValue" class="block text-center text-gray-700 font-medium mt-1">2</span></div>
                            <div class="mb-4"><label for="fontSize" class="block text-gray-700 text-sm font-medium mb-2">Font Size:</label><input type="range" id="fontSize" name="fontSize" min="12" max="24" value="16" class="form-range accent-blue-600 w-full"><span id="fontSizeValue" class="block text-center text-gray-700 font-medium mt-1">16px</span></div>
                            <div class="mb-4"><label for="lineHeight" class="block text-gray-700 text-sm font-medium mb-2">Line Height:</label><input type="range" id="lineHeight" name="lineHeight" min="1.2" max="2.0" value="1.6" step="0.1" class="form-range accent-blue-600 w-full"><span id="lineHeightValue" class="block text-center text-gray-700 font-medium mt-1">1.6</span></div>
                            <div class="mb-4"><label for="letterSpacing" class="block text-gray-700 text-sm font-medium mb-2">Letter Spacing:</label><input type="range" id="letterSpacing" name="letterSpacing" min="0" max="2" value="0" step="0.1" class="form-range accent-blue-600 w-full"><span id="letterSpacingValue" class="block text-center text-gray-700 font-medium mt-1">0px</span></div>
                            <button id="convertBtn" class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 transition ease-in-out duration-150 mt-4">Convert & Apply Settings</button>
                            <button id="exportPdfBtn" class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-md shadow hover:bg-green-700 transition ease-in-out duration-150 mt-4">Export to PDF</button>
                        </div>
                    </div>
                </div>
            `,
            "picker-app": `
                <div class="container mx-auto bg-white p-6 rounded-lg shadow-xl max-w-lg w-full flex flex-col items-center">
                    <h1 class="text-2xl font-bold mb-4 text-gray-800">Random Picker</h1>
                    <div class="flex w-full gap-2 mb-4">
                        <input id="pickerInput" type="text" class="flex-grow border border-slate-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500" placeholder="Enter an option...">
                        <button id="addOptionBtn" class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700">Add</button>
                    </div>
                    <ul id="optionsList" class="w-full mb-6 list-disc pl-6 text-slate-700"></ul>
                    <button id="pickRandomBtn" class="bg-green-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-green-700 mb-4" disabled>Pick Random</button>
                    <div id="pickerResult" class="text-2xl font-bold text-center mt-4 min-h-[2.5rem]"></div>
                </div>
            `
        };

        document.addEventListener('DOMContentLoaded', () => {
            // --- TAB SWITCHING LOGIC ---
            const appTabs = document.getElementById('app-tabs');
            const appContainers = document.querySelectorAll('.app-container');

            appTabs.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const targetApp = e.target.dataset.app;
                    appTabs.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    appContainers.forEach(container => {
                        container.style.display = container.id === targetApp ? 'flex' : 'none';
                    });
                }
            });

            // --- INJECT APP HTML ---
            Object.keys(appTemplates).forEach(appId => {
                 document.getElementById(appId).innerHTML = appTemplates[appId];
            });

            // --- INITIALIZE RANDOM PICKER ---
            const pickerApp = document.getElementById('picker-app');
            if (pickerApp) {
                const pickerInput = pickerApp.querySelector('#pickerInput');
                const addOptionBtn = pickerApp.querySelector('#addOptionBtn');
                const optionsList = pickerApp.querySelector('#optionsList');
                const pickRandomBtn = pickerApp.querySelector('#pickRandomBtn');
                const pickerResult = pickerApp.querySelector('#pickerResult');
                let options = [];

                function renderOptions() {
                    optionsList.innerHTML = options.map((opt, i) => `<li class="flex items-center justify-between">${opt} <button data-idx="${i}" class="ml-2 text-red-500 hover:text-red-700 text-xs">âœ•</button></li>`).join('');
                    pickRandomBtn.disabled = options.length < 2;
                }

                addOptionBtn.addEventListener('click', () => {
                    const val = pickerInput.value.trim();
                    if (val && !options.includes(val)) {
                        options.push(val);
                        pickerInput.value = '';
                        renderOptions();
                        pickerResult.textContent = '';
                    }
                });
                pickerInput.addEventListener('keydown', e => { if (e.key === 'Enter') addOptionBtn.click(); });
                optionsList.addEventListener('click', e => {
                    if (e.target.tagName === 'BUTTON') {
                        const idx = parseInt(e.target.dataset.idx, 10);
                        options.splice(idx, 1);
                        renderOptions();
                        pickerResult.textContent = '';
                    }
                });

                pickRandomBtn.addEventListener('click', () => {
                    if (options.length < 2) return;
                    pickerResult.textContent = '';
                    let suspenseCycles = 18 + Math.floor(Math.random() * 8);
                    let current = 0;
                    let lastIdx = -1;
                    function suspensePick() {
                        if (current < suspenseCycles) {
                            let idx;
                            do { idx = Math.floor(Math.random() * options.length); } while (idx === lastIdx && options.length > 1);
                            lastIdx = idx;
                            pickerResult.textContent = options[idx];
                            pickerResult.style.color = '#64748b';
                            pickerResult.style.fontSize = '2rem';
                            setTimeout(suspensePick, 80 + current * 8);
                            current++;
                        } else {
                            const winnerIdx = Math.floor(Math.random() * options.length);
                            pickerResult.textContent = options[winnerIdx];
                            pickerResult.style.color = '#16a34a';
                            pickerResult.style.fontSize = '2.5rem';
                        }
                    }
                    suspensePick();
                });
            }

            // --- INITIALIZE MARKDOWN EDITOR ---
            const markdownApp = document.getElementById('markdown-app');
            if(markdownApp) {
                const markdownInput = markdownApp.querySelector('#markdown-input');
                const htmlOutput = markdownApp.querySelector('#html-output');
                const exportButton = markdownApp.querySelector('#exportButton');
                const resizer = markdownApp.querySelector('#resizer');
                const mainContainer = markdownApp.querySelector('#main-container');
                const boldBtn = markdownApp.querySelector('#boldBtn');
                const italicBtn = markdownApp.querySelector('#italicBtn');
                const strikeBtn = markdownApp.querySelector('#strikeBtn');
                const headingBtn = markdownApp.querySelector('#headingBtn');
                const linkBtn = markdownApp.querySelector('#linkBtn');
                const bionicBtn = markdownApp.querySelector('#bionicBtn');
                
                marked.setOptions({ breaks: false, gfm: true });

                const updatePreview = () => {
                    const processed = markdownInput.value.replace(/\n(\n)+/g, (match) => {
                        const blankCount = match.length - 1;
                        let result = '\n\n';
                        for (let i = 1; i < blankCount; i++) result += '<br>\n\n';
                        return result;
                    });
                    htmlOutput.innerHTML = marked.parse(processed);
                };
                const exportMarkdown = () => {
                    const blob = new Blob([markdownInput.value], { type: 'text/markdown' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = 'document.md';
                    document.body.appendChild(a); a.click();
                    document.body.removeChild(a); URL.revokeObjectURL(url);
                };

                let isResizing = false;
                resizer.addEventListener('mousedown', () => { isResizing = true; resizer.classList.add('resizing'); document.body.style.cursor = 'col-resize'; });
                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    const containerLeft = mainContainer.getBoundingClientRect().left;
                    const resizerPos = e.clientX - containerLeft;
                    mainContainer.style.gridTemplateColumns = `${resizerPos}px 8px 1fr`;
                });
                document.addEventListener('mouseup', () => { isResizing = false; resizer.classList.remove('resizing'); document.body.style.cursor = 'default'; });

                function wrapText(before, after) {
                    const start = markdownInput.selectionStart, end = markdownInput.selectionEnd;
                    const text = markdownInput.value, selectedText = text.substring(start, end);
                    markdownInput.value = text.substring(0, start) + before + selectedText + after + text.substring(end);
                    markdownInput.focus();
                    if (start === end) {
                        markdownInput.selectionStart = markdownInput.selectionEnd = start + before.length;
                    } else {
                        markdownInput.selectionStart = start + before.length;
                        markdownInput.selectionEnd = end + before.length;
                    }
                    updatePreview();
                }

                function indentLine(increase) {
                    const pos = markdownInput.selectionStart;
                    const selEnd = markdownInput.selectionEnd;
                    const text = markdownInput.value;
                    const lineStart = text.lastIndexOf('\n', pos - 1) + 1;
                    const lineEnd = text.indexOf('\n', pos);
                    const endPos = lineEnd === -1 ? text.length : lineEnd;
                    const line = text.substring(lineStart, endPos);
                    const newLine = increase ? '  ' + line : line.replace(/^  /, '').replace(/^ /, '');
                    const diff = newLine.length - line.length;
                    markdownInput.value = text.substring(0, lineStart) + newLine + text.substring(endPos);
                    markdownInput.selectionStart = Math.max(lineStart, pos + diff);
                    markdownInput.selectionEnd = Math.max(lineStart, selEnd + diff);
                    updatePreview();
                }

                boldBtn.addEventListener('click', () => wrapText('**', '**'));
                italicBtn.addEventListener('click', () => wrapText('*', '*'));
                strikeBtn.addEventListener('click', () => wrapText('~~', '~~'));

                headingBtn.addEventListener('click', () => {
                    const pos = markdownInput.selectionStart;
                    const text = markdownInput.value;
                    const lineStart = text.lastIndexOf('\n', pos - 1) + 1;
                    const lineEnd = text.indexOf('\n', pos);
                    const endPos = lineEnd === -1 ? text.length : lineEnd;
                    const line = text.substring(lineStart, endPos);
                    const m = line.match(/^(#{1,6}) /);
                    let newLine;
                    if (m && m[1].length < 6) {
                        newLine = '#'.repeat(m[1].length + 1) + ' ' + line.substring(m[1].length + 1);
                    } else if (m) {
                        newLine = line.substring(m[1].length + 1);
                    } else {
                        newLine = '## ' + line;
                    }
                    markdownInput.value = text.substring(0, lineStart) + newLine + text.substring(endPos);
                    markdownInput.focus();
                    updatePreview();
                });

                linkBtn.addEventListener('click', () => {
                    const start = markdownInput.selectionStart, end = markdownInput.selectionEnd;
                    const text = markdownInput.value;
                    const selected = text.substring(start, end) || 'link text';
                    const inserted = '[' + selected + '](url)';
                    markdownInput.value = text.substring(0, start) + inserted + text.substring(end);
                    markdownInput.focus();
                    markdownInput.selectionStart = start + 1 + selected.length + 2;
                    markdownInput.selectionEnd = start + 1 + selected.length + 5;
                    updatePreview();
                });

                markdownInput.addEventListener('input', updatePreview);
                exportButton.addEventListener('click', exportMarkdown);

                // Keyboard shortcuts
                markdownInput.addEventListener('keydown', (e) => {
                    const cmdKey = e.metaKey || e.ctrlKey;

                    if (cmdKey && e.key === 'b') { e.preventDefault(); wrapText('**', '**'); return; }
                    if (cmdKey && e.key === 'i') { e.preventDefault(); wrapText('*', '*'); return; }
                    if (cmdKey && e.shiftKey && (e.key === 's' || e.key === 'S')) { e.preventDefault(); wrapText('~~', '~~'); return; }
                    if (cmdKey && e.key === 'k') { e.preventDefault(); linkBtn.click(); return; }
                    if (cmdKey && e.key === ']') { e.preventDefault(); indentLine(true); return; }
                    if (cmdKey && e.key === '[') { e.preventDefault(); indentLine(false); return; }

                    if (e.key === 'Enter') {
                        const pos = markdownInput.selectionStart;
                        const text = markdownInput.value;
                        const lineStart = text.lastIndexOf('\n', pos - 1) + 1;
                        const lineBeforeCursor = text.substring(lineStart, pos);

                        const bulletMatch = lineBeforeCursor.match(/^(\s*)([-*+]) (.*)$/);
                        if (bulletMatch) {
                            e.preventDefault();
                            if (!bulletMatch[3].trim()) {
                                markdownInput.value = text.substring(0, lineStart) + text.substring(pos);
                                markdownInput.selectionStart = markdownInput.selectionEnd = lineStart;
                            } else {
                                const insert = '\n' + bulletMatch[1] + bulletMatch[2] + ' ';
                                markdownInput.value = text.substring(0, pos) + insert + text.substring(pos);
                                markdownInput.selectionStart = markdownInput.selectionEnd = pos + insert.length;
                            }
                            updatePreview();
                            return;
                        }

                        const numberedMatch = lineBeforeCursor.match(/^(\s*)(\d+)\. (.*)$/);
                        if (numberedMatch) {
                            e.preventDefault();
                            if (!numberedMatch[3].trim()) {
                                markdownInput.value = text.substring(0, lineStart) + text.substring(pos);
                                markdownInput.selectionStart = markdownInput.selectionEnd = lineStart;
                            } else {
                                const insert = '\n' + numberedMatch[1] + (parseInt(numberedMatch[2], 10) + 1) + '. ';
                                markdownInput.value = text.substring(0, pos) + insert + text.substring(pos);
                                markdownInput.selectionStart = markdownInput.selectionEnd = pos + insert.length;
                            }
                            updatePreview();
                            return;
                        }
                    }
                });

                // Synchronized scrolling
                let isSyncing = false;
                markdownInput.addEventListener('scroll', () => {
                    if (isSyncing) return;
                    isSyncing = true;
                    const pct = markdownInput.scrollTop / (markdownInput.scrollHeight - markdownInput.clientHeight);
                    htmlOutput.scrollTop = pct * (htmlOutput.scrollHeight - htmlOutput.clientHeight);
                    isSyncing = false;
                });
                htmlOutput.addEventListener('scroll', () => {
                    if (isSyncing) return;
                    isSyncing = true;
                    const pct = htmlOutput.scrollTop / (htmlOutput.scrollHeight - htmlOutput.clientHeight);
                    markdownInput.scrollTop = pct * (markdownInput.scrollHeight - markdownInput.clientHeight);
                    isSyncing = false;
                });

                bionicBtn.addEventListener('click', () => {
                    const textToTransfer = markdownInput.value;
                    const bionicReaderInput = document.querySelector('#bionic-app #inputText');
                    const bionicReaderConvertBtn = document.querySelector('#bionic-app #convertBtn');
                    const bionicReaderTab = document.querySelector('button[data-app="bionic-app"]');
                    if (bionicReaderInput && bionicReaderConvertBtn && bionicReaderTab) {
                        bionicReaderInput.value = textToTransfer;
                        bionicReaderTab.click();
                        bionicReaderConvertBtn.click();
                    }
                });

                updatePreview();
            }

            // --- INITIALIZE WEBP CONVERTER ---
            const webpApp = document.getElementById('webp-app');
            if(webpApp) {
                const webpFileElement = webpApp.querySelector('#webpFile');
                const convertButtonElement = webpApp.querySelector('#convertButton');
                const outputAreaElement = webpApp.querySelector('#outputArea');
                let selectedFile = null;
                webpFileElement.addEventListener('change', function (event) {
                    selectedFile = event.target.files[0];
                    convertButtonElement.disabled = !selectedFile || selectedFile.type !== "image/webp";
                });
                convertButtonElement.addEventListener('click', function () {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const image = new Image();
                        image.onload = function () {
                            const canvas = document.createElement('canvas');
                            canvas.width = image.width; canvas.height = image.height;
                            canvas.getContext('2d').drawImage(image, 0, 0);
                            const dataUrl = canvas.toDataURL('image/png');
                            outputAreaElement.innerHTML = `<img src="${dataUrl}"><br><a href="${dataUrl}" download="converted.png" class="mt-2 inline-block bg-blue-600 text-white p-2 rounded">Download PNG</a>`;
                        };
                        image.src = event.target.result;
                    };
                    reader.readAsDataURL(selectedFile);
                });
            }

            // --- INITIALIZE BIONIC READER (FIXED SECTION) ---
            const bionicApp = document.getElementById('bionic-app');
            if(bionicApp) {
                const inputText = bionicApp.querySelector('#inputText');
                const outputArea = bionicApp.querySelector('#outputArea');
                const convertBtn = bionicApp.querySelector('#convertBtn');
                const exportPdfBtn = bionicApp.querySelector('#exportPdfBtn');
                const boldIntensitySlider = bionicApp.querySelector('#boldIntensity');
                const intensityValueSpan = bionicApp.querySelector('#intensityValue');
                const fontSizeSlider = bionicApp.querySelector('#fontSize');
                const fontSizeValueSpan = bionicApp.querySelector('#fontSizeValue');
                const lineHeightSlider = bionicApp.querySelector('#lineHeight');
                const lineHeightValueSpan = bionicApp.querySelector('#lineHeightValue');
                const letterSpacingSlider = bionicApp.querySelector('#letterSpacing');
                const letterSpacingValueSpan = bionicApp.querySelector('#letterSpacingValue');

                // FIXED: Configure marked to treat single line breaks as <br>
                marked.setOptions({
                    breaks: true,
                    gfm: true
                });

                function applyBionicFormattingToWord(word, intensity) {
                    const boldLength = Math.max(1, Math.min(intensity, Math.ceil(word.length / 2)));
                    return `<span class="bionic-bold">${word.substring(0, boldLength)}</span>${word.substring(boldLength)}`;
                }

                function applyBionicFormattingToNode(node, intensity) {
                    if (node.nodeType === 3) {
                        const wordsAndSeparators = node.nodeValue.match(/(\S+|\s+)/g) || [];
                        let formattedHtml = wordsAndSeparators.map(item => /\S/.test(item) ? applyBionicFormattingToWord(item, intensity) : item).join('');
                        const tempSpan = document.createElement('span'); tempSpan.innerHTML = formattedHtml;
                        while (tempSpan.firstChild) { node.parentNode.insertBefore(tempSpan.firstChild, node); }
                        node.parentNode.removeChild(node);
                    } else if (node.nodeType === 1 && node.tagName.toLowerCase() !== 'script' && node.tagName.toLowerCase() !== 'style') {
                        for (let i = node.childNodes.length - 1; i >= 0; i--) { applyBionicFormattingToNode(node.childNodes[i], intensity); }
                    }
                }

                function applyTextStyling() {
                    const fontSize = fontSizeSlider.value + 'px', lineHeight = lineHeightSlider.value, letterSpacing = letterSpacingSlider.value + 'px';
                    outputArea.style.fontSize = fontSize; outputArea.style.lineHeight = lineHeight; outputArea.style.letterSpacing = letterSpacing;
                    fontSizeValueSpan.textContent = fontSize; lineHeightValueSpan.textContent = lineHeight; letterSpacingValueSpan.textContent = letterSpacing;
                }

                function performConversionAndStyling() {
                    // Convert sequences of multiple blank lines into explicit <br> spacers
                    const processed = inputText.value.replace(/\n(\n)+/g, (match) => {
                        const blankCount = match.length - 1;
                        let result = '\n\n';
                        for (let i = 1; i < blankCount; i++) result += '<br>\n\n';
                        return result;
                    });
                    const markdownRenderedHtml = marked.parse(processed);
                    const tempElement = document.createElement('div'); tempElement.innerHTML = markdownRenderedHtml;
                    applyBionicFormattingToNode(tempElement, parseInt(boldIntensitySlider.value, 10));
                    outputArea.innerHTML = tempElement.innerHTML;
                    applyTextStyling();
                }

                convertBtn.addEventListener('click', performConversionAndStyling);
                boldIntensitySlider.addEventListener('input', () => { intensityValueSpan.textContent = boldIntensitySlider.value; performConversionAndStyling(); });
                fontSizeSlider.addEventListener('input', () => { fontSizeValueSpan.textContent = fontSizeSlider.value + 'px'; applyTextStyling(); });
                lineHeightSlider.addEventListener('input', () => { lineHeightValueSpan.textContent = lineHeightSlider.value; applyTextStyling(); });
                letterSpacingSlider.addEventListener('input', () => { letterSpacingValueSpan.textContent = letterSpacingSlider.value + 'px'; applyTextStyling(); });
                
                exportPdfBtn.addEventListener('click', () => {
                    html2canvas(outputArea, { scale: 2 }).then(canvas => {
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF({ orientation: 'p', unit: 'px', format: [canvas.width, canvas.height] });
                        pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, canvas.width, canvas.height);
                        pdf.save('bionic-reader-output.pdf');
                    });
                });

                applyTextStyling();
            }
        });
    </script>
</body>
</html>